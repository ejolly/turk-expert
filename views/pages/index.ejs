<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

	<script src="//code.jquery.com/jquery-1.12.3.js"></script> 
	<link rel="stylesheet" type="text/css" href="/public/css/bootstrap.min.css"/>
	<link rel="stylesheet" type="text/css" href="/public/css/client.css"/>
    <title>
        Welcome to the Experiment - Powered by Turk Expert v0.1.0
    </title>
</head>

<body>

<% if(!auth){ %>
	<!--Auth form -->
	<div class="form-group col-xs-4 col-xs-offset-4 centered">
		<form method='post' action='validateCode' class='form-horizontal'>
			<label>Please enter an access code to work on this HIT</label> 
			<input class="form-control" name="accessCode" size="25" type="text" />
			<input class="form-control" name="accessType" size="25" type="text" value="<%= e.type %>" style="display:none;"/>
			<input class="form-control" name="accessContent" size="25" type="text" value="<%= e.content %>" style="display:none;"/>
			<input class="form-control" name="accessObj[wid]" size="25" type="text" value="<%= e.obj.wid %>" style="display:none;"/>
			<input class="form-control" name="accessObj[hid]" size="25" type="text" value="<%= e.obj.hid %>" style="display:none;"/>
			<% if(e.code === 403){ %> 
			<p class="authFeedback">This access code is incorrect!</p> 
			<% } %>
			<div class="centered">
				<!--<input type="submit" id="submitButton" class="btn btn-lg btn-primary" value= "Submit">-->
				<button class="btn btn-lg btn-primary" type="submit">Submit</button>
			</div>
		</form>
	</div>
 <% } else{ %>  

	<% if(e.firstTimeUser && e.firstTimeUser != 'shared'){ %>
	<!-- if e.firstTImeUser === 'Treament' .... all 5 tempaltes -->
	<!-- This modal should pop up if a Worker successfully enters an access code, but we never sent it to them -->
	<form id="First-User-Form" action="firstUser" method="POST">
	<div class="popup" data-keyboard="false" data-backdrop="static" id="preHITSurvey">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">How did you learn about the access code for this HIT?</h4>
				</div>
				<div class="modal-body">
					<div class="radio">
					<label><input required="" type="radio" name="sharedSource[personal]" value="personal">Personal communication with another Turker</label>
					</div>
					<div class="radio">
					<label><input required= "" type="radio" name="sharedSource[forum]" value="forum">I saw the access code posted online</label>
					</div>
					<div class="input-group" style="margin-left: 3em">Please enter the name of the forum, group or website where you saw the access code posted: 
					<input name="sharedSource[whichForum]" size="1" style="height: 1.5em; width: 5em" type="text" /></div>
					<input class="form-control" name="accessContent" size="25" type="text" value="<%= e.content %>" style="display:none;"/>
					<input class="form-control" name="accessObj" size="25" type="text" value="<%= e.obj %>" style="display:none;"/>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-primary">Proceed</button> 
				</div>
			</div>
		</div>
	</div>
	</form>
	<% } else { %>

	<!-- Main HIT Content -->
	<div class="col-xs-6 col-xs-offset-3">
			<blockquote class="twitter-tweet">
				<p>
					<%= e.content.Tweet %> <br>
					- @<%= e.content.User %> <%= e.content.Time %>, <%= e.content.Date %>
				</p>
			</blockquote>
	</div>
	<div class="col-xs-6 col-xs-offset-3">
		<form class="form" role="form" id="HIT-Form" action="mturk/externalSubmit" method="POST">
			<fieldset>
				<h5><strong>1) Is this tweet in English?</strong></h5>
				<div class="radio-inline"><label><input name="inEnglish" required="" type="radio" value="0"/>No</label></div>
				<div class="radio-inline"><label><input name="inEnglish" required="" type="radio" value="1"/>Yes</label></div>
			</fieldset>
			
			<fieldset>
				<h5><strong>2) Does this tweet contain a URL?</strong></h5>
				<div class="radio"><label><input name="hasURL" required="" type="radio" value="0"/>No</label></div>
				<div class="radio"><label><input name="hasURL" required="" type="radio" value="1"/>Yes</label></div>
				<div class="subquestion">
					<p>Is this a working URL?</p>
					<div class="radio-inline"><label><input name="validURL" type="radio" value="1"/>Yes</label></div>
					<div class="radio-inline"><label><input name="validURL" type="radio" value="0"/>No</label></div>
					<p class="validationMessage" id="validate2a">Please select a response</p>
					<p>What kind of page does it point to?</p>
					<p class="subheading">E.g. News story, video, image, etc</p>
					<div class="input-group"><input id="URLcontent" name="URLcontent" size="1" style="height: 2em; width: 15em" type="text" /></div>
					<p class="validationMessage" id="validate2b">Please enter a response</p>
				</div>
			</fieldset>
			
			<fieldset>
				<h5><strong>3) Does the tweet refer to a specific kind of hurricane-related damage? </strong></h5>
				<div class="radio"><label><input name="aboutDamage" required="" type="radio" value="0"/>No</label></div>
				<div class="radio"><label><input name="aboutDamage" required="" type="radio" value="1"/>Yes</label></div>
				<div class="subquestion">
					<p>What kind of damage is referred to?</p>
					<p class="subheading">Check all that apply</p>
					<div class="checkbox-group checkbox" required="">
					<label><input class="damage" name="damage" type="checkbox" value="bridges"/>Damaged bridges</label><br />
					<label><input class="damage" name="damage" type="checkbox" value="crops"/>Damaged crops</label><br />
					<label><input class="damage" name="damage" type="checkbox" value="healthFacilities"/>Damaged hospitals/health facilities</label><br />
					<label><input class="damage" name="damage" type="checkbox" value="housing"/>Damaged housing</label><br />
					<label><input class="damage" name="damage" type="checkbox" value="roads"/>Damaged roads</label><br />
					<label><input class="damage" name="damage" type="checkbox" value="schools"/>Damaged schools</label><br />
					<label><input class="damage" name="damage" type="checkbox" value="vehicles"/>Damaged vehicles</label><br />
					<label><input class="damage" name="damage" type="checkbox" value="infrastructure"/>Damaged infrastructure</label><br />
					<label><input class="damage" name="damage" type="checkbox" value="deaths"/>Deaths reported</label><br />
					<label><input class="damage" name="damage" type="checkbox" value="displacedPopulation"/>Displaced population</label><br />
					<label><input class="damage" name="damage" type="checkbox" value="evacCenter"/>Evacuation center</label><br />
					<label><input class="damage" name="damage" type="checkbox" value="flooding"/>Flooding</label><br />
				</div>
				<p class="validationMessage" id="validate3">Please check at least one box</p>
			</fieldset>

			<div class="centered">
				<input type="submit" id="submitButton" class="btn btn-lg btn-primary" value= "Submit">
			</div>
		</form>
	</div>

	<script type=text/javascript>
	window.onload = function() {document.getElementById('submitButton').setAttribute('onclick', 'return validateForm()'); }
	function validateForm(){
		var submitReady = true;
		//Yes for question 2
		if($('input:radio[name=hasURL]:checked').val() === "1"){
			if(!$('input:radio[name=validURL]:checked').val()){
				$('#validate2a').css('visibility','visible');
				submitReady = false;
			}
			else if(($('input:radio[name=validURL]:checked').val()) && ($('input:radio[name=validURL]:checked').val() === "1") && ($('#URLcontent').val().length === 0)) {
				$('#validate2b').css('visibility','visible');
				submitReady = false;
			} else {
				$('#validate2a').css('visibility','hidden');
				$('#validate2b').css('visibility','hidden');
			}
		} else {
			$('#validate2a').css('visibility','hidden');
			$('#validate2b').css('visibility','hidden');

		}
		//Yes for question 3
		if($('input:radio[name=aboutDamage]:checked').val() === "1"){
			if($('div.checkbox :checkbox:checked').length == 0){
				$('#validate3').css('visibility','visible');
				submitReady = false;
			}
		}
		if(submitReady){			
	    	var turkSubmitTo = window.location.href.split('turkSubmitTo=')[1];
			if(turkSubmitTo){
				//alert('turkSubmitTo='+ turkSubmitTo);
				document.getElementById("HIT-Form").action = turkSubmitTo+"/mturk/externalSubmit";
			}
		} else {
			return false;
		}
	}
	</script>


	<% } %>


<% } %>




</body>

</html>

